
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Testing Web sites with twill &#8212; twill 3.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="twill Extension Modules" href="extensions.html" />
    <link rel="prev" title="twill language reference" href="commands.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="testing-web-sites-with-twill">
<span id="testing"></span><h1>Testing Web sites with twill<a class="headerlink" href="#testing-web-sites-with-twill" title="Permalink to this headline">¶</a></h1>
<p>twill was initially designed for testing web sites, although since then
people have also figured out that it’s good for <a class="reference internal" href="browsing.html#browsing"><span class="std std-ref">browsing</span></a>
unsuspecting web sites.</p>
<section id="using-the-twill-command">
<h2>Using the twill command<a class="headerlink" href="#using-the-twill-command" title="Permalink to this headline">¶</a></h2>
<p>The simplest way to test Web sites is to write one or more twill scripts
and then simply run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twill</span> <span class="p">[</span> <span class="o">-</span><span class="n">u</span> <span class="n">initial_url</span> <span class="p">]</span> <span class="n">script</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>either from the command-line (for development purposes), via a cron job
(to check to see if sites are up and responding), or from your functional
or unit tests (see below).</p>
<p>twill will try to run each script given to it on the command line
once, and will report the number of scripts that failed. The exit value
of the script will be 0 if there are no failures, so you can use it in
a shell script easily enough.</p>
<p>twill will gather scripts from directories, so you can create a whole
directory hierarchy containing your scripts and they will all be gathered
and run, in standard lexical order.</p>
<p>twill scripts are assumed to have the ‘.twill’ extensions; you don’t
need to specify it explicitly.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-u</span></code> flag can be used to give twill an initial URL; this is
equivalent to placing a “go (initial_url)” command at the top of the
script, but is particularly handy for test frameworks where the URL
might change depending on the developer.</p>
</section>
<section id="stress-testing">
<h2>Stress testing<a class="headerlink" href="#stress-testing" title="Permalink to this headline">¶</a></h2>
<p>You can use the <cite>twill-fork</cite> script to do some stress testing.
The syntax is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twill</span><span class="o">-</span><span class="n">fork</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">number</span> <span class="n">to</span> <span class="n">execute</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">number</span> <span class="n">of</span> <span class="n">processes</span><span class="o">&gt;</span> <span class="n">script</span> <span class="p">[</span> <span class="n">scripts</span><span class="o">...</span> <span class="p">]</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twill</span><span class="o">-</span><span class="n">fork</span> <span class="o">-</span><span class="n">n</span> <span class="mi">500</span> <span class="o">-</span><span class="n">p</span> <span class="mi">10</span> <span class="n">test</span><span class="o">-</span><span class="n">script</span>
</pre></div>
</div>
<p>will fork 10 times and run <cite>test-script</cite> 50 times in each process.
<cite>twill-fork</cite> will record the time it takes to run all of the scripts specified
on the command and print a summary at the end.</p>
<p>The time recorded is <em>not</em> the CPU time used. (This would lead to an
inaccurate estimate because the client code uses blocking calls to
retrieve Web pages.)  Rather, the time recorded is the clock time
measured between the start and end of script execution.</p>
<p>Try <cite>twill-fork -h</cite> to get a list of other command line arguments.</p>
<p>Note that twill-fork runs only under Unix and still needs a lot of work…</p>
</section>
<section id="unit-testing">
<h2>Unit testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h2>
<p>twill can be used in unit testing, and it contains some Python support
infrastructure for this purpose.</p>
<p>As an example, here’s the code from twill’s own unit test, testing the
unit-test support code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">twill</span>
<span class="kn">from</span> <span class="nn">quixote.server.simple_server</span> <span class="kn">import</span> <span class="n">run</span> <span class="k">as</span> <span class="n">quixote_run</span>

<span class="n">PORT</span><span class="o">=</span><span class="mi">8090</span>  <span class="c1"># port to run the server on</span>

<span class="k">def</span> <span class="nf">run_server</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Function to run the server&quot;&quot;&quot;</span>
    <span class="n">quixote_run</span><span class="p">(</span><span class="n">twill</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">PORT</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;The unit test&quot;&quot;&quot;</span>
    <span class="n">test_dir</span> <span class="o">=</span> <span class="n">twill</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">testdir</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_dir</span><span class="p">,</span> <span class="s1">&#39;test_unit_support.twill&#39;</span><span class="p">)</span>

    <span class="c1"># create test_info object</span>
    <span class="n">test_info</span> <span class="o">=</span> <span class="n">twill</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">TestInfo</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">run_server</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

    <span class="c1"># run tests!</span>
    <span class="n">twill</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">run_test</span><span class="p">(</span><span class="n">test_info</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, I’m unit testing the Quixote application <code class="docutils literal notranslate"><span class="pre">twill.tests.server</span></code>, which
is run by <code class="docutils literal notranslate"><span class="pre">quixote_run</span></code> (a.k.a. <code class="docutils literal notranslate"><span class="pre">quixote.server.simple_server.run</span></code>) on
port <code class="docutils literal notranslate"><span class="pre">PORT</span></code>, using the twill script <code class="docutils literal notranslate"><span class="pre">test_unit_support.twill</span></code>. That
script contains this code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># starting URL is provided to it by the unit test support framework.</span>

<span class="n">go</span> <span class="o">./</span><span class="n">multisubmitform</span>
<span class="n">code</span> <span class="mi">200</span>
</pre></div>
</div>
<p>A few things to note:</p>
<blockquote>
<div><ul class="simple">
<li><p>the initial URL is set based on the URL reported by <code class="docutils literal notranslate"><span class="pre">TestInfo</span></code>,
which calculates it based on the <code class="docutils literal notranslate"><span class="pre">PORT</span></code> argument.
(This can be overridden by subclasses.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TestInfo</span></code> contains code to (a) run the server function in a new
process, and (b) run the twill script against that server. It then
kills the server after script completion.</p></li>
<li><p>You can also pass a ‘sleep’ argument to the <code class="docutils literal notranslate"><span class="pre">TestInfo</span></code> constructor that
specifies how many seconds to wait for the server to start before
executing the script.</p></li>
</ul>
</div></blockquote>
</section>
<section id="testing-wsgi-applications-in-process">
<h2>Testing WSGI applications “in-process”<a class="headerlink" href="#testing-wsgi-applications-in-process" title="Permalink to this headline">¶</a></h2>
<p>You can use <a class="reference external" href="https://pypi.python.org/pypi/wsgi_intercept">wsgi_intercept</a> for testing <a class="reference external" href="https://www.python.org/dev/peps/pep-0333/">WSGI applications</a>.</p>
<p>It provides two functions, <cite>add_wsgi_intercept</cite> and <cite>remove_wsgi_intercept</cite>,
that allow Python applications to redirect HTTP calls into a WSGI application
“in-process”, without going via an external Internet call. This is
particularly useful for unit tests, where setting up an externally
available Web server can be inconvenient.</p>
<p>For example, the following code redirects all <code class="docutils literal notranslate"><span class="pre">localhost:80</span></code> calls to
the given WSGI app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_app</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">wsgi_app</span>

<span class="kn">import</span> <span class="nn">wsgi_intercept</span>

<span class="n">wsgi_intercept</span><span class="o">.</span><span class="n">requests_intercept</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
<span class="n">wsgi_intercept</span><span class="o">.</span><span class="n">add_wsgi_intercept</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">create_app</span><span class="p">)</span>
<span class="c1"># your twill tests go here...</span>
<span class="n">wsgi_intercept</span><span class="o">.</span><span class="n">remove_wsgi_intercept</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">wsgi_intercept</span><span class="o">.</span><span class="n">requests_intercept</span><span class="o">.</span><span class="n">uninstall</span><span class="p">()</span>
</pre></div>
</div>
<p>See the <code class="docutils literal notranslate"><span class="pre">tests/test_wsgi_intercept.py</span></code> unit test for more examples.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">twill</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">twill Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing twill</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">ChangeLog</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">twill Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="browsing.html">Web browsing with twill</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">twill language reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing Web sites with twill</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-the-twill-command">Using the twill command</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stress-testing">Stress testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unit-testing">Unit testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-wsgi-applications-in-process">Testing WSGI applications “in-process”</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">twill Extension Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-api.html">twill’s Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developing twill</a></li>
<li class="toctree-l1"><a class="reference internal" href="other.html">Propaganda, tools and packages</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="commands.html" title="previous chapter">twill language reference</a></li>
      <li>Next: <a href="extensions.html" title="next chapter">twill Extension Modules</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, C. Titus Brown, Ben R. Taylor et al.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/testing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>